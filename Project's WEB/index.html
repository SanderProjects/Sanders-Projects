<script>
    // --- JAVASCRIPT LOGICA ---
    
    // Configuratie voor het ophalen van posts (PAS DIT AAN!)
    const GITHUB_REPO_OWNER = 'SanderProjects'; // JOUW GEBRUIKERSNAAM
    const GITHUB_REPO_NAME = 'Sanders-Projects'; // JOUW REPO NAAM
    const POSTS_FOLDER = 'Project\'s WEB/_posts/'; // De map waar Netlify CMS de artikelen opslaat

    function openProject(projectId) {
        document.getElementById('home-screen').style.display = 'none';
        window.scrollTo(0, 0);
        const project = document.getElementById(projectId);
        project.style.display = 'block';
        setTimeout(() => { project.classList.add('active'); }, 10);
        
        if (projectId === 'journalist') {
            loadCMSPosts();
        }
    }

    function goHome() {
        const pages = document.querySelectorAll('.page-section');
        pages.forEach(page => {
            page.style.display = 'none';
            page.classList.remove('active');
        });
        document.getElementById('home-screen').style.display = 'block';
        const header = document.querySelector('header');
        header.style.animation = 'none';
        header.offsetHeight; 
        header.style.animation = 'fadeIn 1s ease';
    }

    // Functie om de CMS-posts op te halen en weer te geven
    async function loadCMSPosts() {
        const postsContainer = document.getElementById('posts-container');
        postsContainer.innerHTML = 'Artikelen worden geladen...';

        try {
            // Stap 1: Haal de lijst met bestanden uit de _posts map (via GitHub API)
            const apiUrl = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${POSTS_FOLDER}`;
            const fileListResponse = await fetch(apiUrl);
            
            if (!fileListResponse.ok) {
                postsContainer.innerHTML = '<p>Fout bij het laden van artikelen. Controleer of de GITHUB_REPO_OWNER/NAME juist is ingesteld.</p>';
                return;
            }
            
            const files = await fileListResponse.json();
            
            // Filter alleen op Markdown bestanden (.md)
            const mdFiles = files.filter(file => file.name.endsWith('.md'));
            
            if (mdFiles.length === 0) {
                postsContainer.innerHTML = '<p>Nog geen artikelen gevonden. Maak de eerste post in het CMS!</p>';
                return;
            }

            postsContainer.innerHTML = ''; // Leegmaken voor de nieuwe posts

            // Stap 2: Loop door elk bestand en haal de inhoud op
            for (const file of mdFiles) {
                // Haal de inhoud op
                const postResponse = await fetch(file.download_url);
                const rawMarkdown = await postResponse.text();

                // Extreer de Front Matter (metadata) en Body
                const { metadata, body } = parseMarkdown(rawMarkdown);
                
                // Stap 3: Renderen op de pagina
                const postHTML = `
                    <div class="article-preview">
                        <h3>${metadata.title || 'Geen Titel'}</h3>
                        <p style="color: var(--text-muted);">${metadata.description || 'Geen samenvatting beschikbaar.'}</p>
                        <p>${body.substring(0, 100)}...</p>
                        <a href="#" style="color: var(--accent);">Lees meer â†’</a>
                    </div>
                `;
                postsContainer.innerHTML += postHTML;
            }

        } catch (error) {
            console.error('Fout bij laden van posts:', error);
            postsContainer.innerHTML = `<p>Er is een onbekende fout opgetreden bij het laden van de artikelen: ${error.message}</p>`;
        }
    }

    // Helper functie om de metadata (Front Matter) van de Markdown te scheiden van de body.
    function parseMarkdown(markdown) {
        const metadata = {};
        let body = markdown;
        
        // Zoek naar de Front Matter (YAML blok tussen '---')
        const match = markdown.match(/^---\s*([\s\S]*?)\s*---([\s\S]*)$/);
        
        if (match) {
            // Parsen van de YAML (heel simplistisch, werkt alleen voor simpele key: value)
            const yamlBlock = match[1];
            body = match[2].trim();
            
            yamlBlock.split('\n').forEach(line => {
                const parts = line.split(':');
                if (parts.length >= 2) {
                    const key = parts[0].trim();
                    const value = parts.slice(1).join(':').trim().replace(/^['"]|['"]$/g, '');
                    metadata[key] = value;
                }
            });
        }
        return { metadata, body };
    }


    // Netlify Identity Widget voor Login
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
</script>
