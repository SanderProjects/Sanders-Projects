<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mijn Projecten Hub</title>
    
    <link rel="stylesheet" href="./css/style.css">
    
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>

<div class="container">

    <div id="home-screen">
        <header>
            <h1>Mijn Projecten</h1>
            <p>Welkom in mijn digitale archief. Kies een project om te beginnen.</p>
        </header>

        <div class="project-grid">
            <div class="card" onclick="openProject('radio100')">
                <span>üéµ</span>
                <h2>Radio 100</h2>
                <p>Mijn jaarlijkse top 100 van de beste nummers.</p>
            </div>
            <div class="card" onclick="openProject('journalist')">
                <span>üì∞</span>
                <h2>De Journalist</h2>
                <p>Artikelen, opinies en stukken die ik heb geschreven.</p>
            </div>
            <div class="card" onclick="openProject('overig')">
                <span>üöÄ</span>
                <h2>Meer Projecten</h2>
                <p>Experimenten, code en andere creatieve uitspattingen.</p>
            </div>
        </div>
    </div>

    <div id="radio100" class="page-section">
        <button class="back-btn" onclick="goHome()">‚Üê Terug naar overzicht</button>
        <h1>Radio 100: De Lijst</h1>
        <p>Hier vind je mijn persoonlijke selectie van dit jaar.</p>
        <div id="radio100-content">
             <ul class="song-list" style="padding:0;">
                <li><strong>1.</strong> Titel van Liedje - Artiest</li>
                <li><strong>2.</strong> Titel van Liedje - Artiest</li>
            </ul>
        </div>
    </div>

    <div id="journalist" class="page-section">
        <button class="back-btn" onclick="goHome()">‚Üê Terug naar overzicht</button>
        <h1>Artikel Archief</h1>
        <p>Recente publicaties. Deze worden beheerd via het CMS!</p>
        
        <div id="posts-container">
            </div>
        
        <div style="margin-top:40px; border-top: 1px solid #333; padding-top:20px;">
            <p>Vind je mijn werk tof? Steun mij met een koffie!</p>
            <button class="donate-btn" onclick="alert('Hier komt de Stripe/PayPal link!')">Steun dit project (‚Ç¨)</button>
        </div>
    </div>

    <div id="overig" class="page-section">
        <button class="back-btn" onclick="goHome()">‚Üê Terug naar overzicht</button>
        <h1>Andere Projecten</h1>
        <p>Work in progress...</p>
    </div>

</div>

<script>
    // --- JAVASCRIPT LOGICA ---
    
    // Configuratie voor het ophalen van posts (PAS DIT AAN!)
    const GITHUB_REPO_OWNER = 'SanderProjects'; // JOUW GEBRUIKERSNAAM
    const GITHUB_REPO_NAME = 'Sanders-Projects'; // JOUW REPO NAAM
    const POSTS_FOLDER = '_posts/';

    function openProject(projectId) {
        document.getElementById('home-screen').style.display = 'none';
        window.scrollTo(0, 0);
        const project = document.getElementById(projectId);
        project.style.display = 'block';
        setTimeout(() => { project.classList.add('active'); }, 10);
        
        if (projectId === 'journalist') {
            loadCMSPosts();
        }
    }

    function goHome() {
        const pages = document.querySelectorAll('.page-section');
        pages.forEach(page => {
            page.style.display = 'none';
            page.classList.remove('active');
        });
        document.getElementById('home-screen').style.display = 'block';
        const header = document.querySelector('header');
        header.style.animation = 'none';
        header.offsetHeight; 
        header.style.animation = 'fadeIn 1s ease';
    }

    // Functie om de CMS-posts op te halen en weer te geven
    async function loadCMSPosts() {
        const postsContainer = document.getElementById('posts-container');
        postsContainer.innerHTML = 'Artikelen worden geladen...';

        try {
            // FIX: Codeer de mapnaam voor de GitHub API om speciale tekens te verwerken
            const encodedPostsFolder = encodeURIComponent(POSTS_FOLDER); // <-- DEZE REGEL IS NIEUW
            
            // Stap 1: Haal de lijst met bestanden uit de _posts map (via GitHub API)
            const apiUrl = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${encodedPostsFolder}`; // <-- HIER WORDT DE GECODEERDE MAP GEBRUIKT
            const fileListResponse = await fetch(apiUrl);
            
            if (!fileListResponse.ok) {
                postsContainer.innerHTML = '<p>Fout bij het laden van artikelen. Controleer of de GITHUB_REPO_OWNER/NAME juist is ingesteld.</p>';
                return;
            }
            
            const files = await fileListResponse.json();
            
            // Filter alleen op Markdown bestanden (.md)
            const mdFiles = files.filter(file => file.name.endsWith('.md'));
            
            if (mdFiles.length === 0) {
                postsContainer.innerHTML = '<p>Nog geen artikelen gevonden. Maak de eerste post in het CMS!</p>';
                return;
            }

            postsContainer.innerHTML = ''; // Leegmaken voor de nieuwe posts

            // Stap 2: Loop door elk bestand en haal de inhoud op
            for (const file of mdFiles) {
                // Haal de inhoud op
                const postResponse = await fetch(file.download_url);
                const rawMarkdown = await postResponse.text();

                // Extreer de Front Matter (metadata) en Body
                const { metadata, body } = parseMarkdown(rawMarkdown);
                
                // Stap 3: Renderen op de pagina
                const postHTML = `
                    <div class="article-preview">
                        <h3>${metadata.title || 'Geen Titel'}</h3>
                        <p style="color: var(--text-muted);">${metadata.description || 'Geen samenvatting beschikbaar.'}</p>
                        <p>${body.substring(0, 100)}...</p>
                        <a href="#" style="color: var(--accent);">Lees meer ‚Üí</a>
                    </div>
                `;
                postsContainer.innerHTML += postHTML;
            }

        } catch (error) {
            console.error('Fout bij laden van posts:', error);
            postsContainer.innerHTML = `<p>Er is een onbekende fout opgetreden bij het laden van de artikelen: ${error.message}</p>`;
        }
    }

    // Helper functie om de metadata (Front Matter) van de Markdown te scheiden van de body.
    function parseMarkdown(markdown) {
        const metadata = {};
        let body = markdown;
        
        // Zoek naar de Front Matter (YAML blok tussen '---')
        const match = markdown.match(/^---\s*([\s\S]*?)\s*---([\s\S]*)$/);
        
        if (match) {
            // Parsen van de YAML (heel simplistisch, werkt alleen voor simpele key: value)
            const yamlBlock = match[1];
            body = match[2].trim();
            
            yamlBlock.split('\n').forEach(line => {
                const parts = line.split(':');
                if (parts.length >= 2) {
                    const key = parts[0].trim();
                    const value = parts.slice(1).join(':').trim().replace(/^['"]|['"]$/g, '');
                    metadata[key] = value;
                }
            });
        }
        return { metadata, body };
    }


    // Netlify Identity Widget voor Login
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
</script>
</body>
</html>

